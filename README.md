# 联邦学习的实验
An experiment about Federated-Learning from this [repository](https://github.com/TsingZ0/PFLlib).

## 初步学习
初步学习发现，框架代码可以分为四个部分。

程序流程、模型类、服务类、客户类。

### 流程
- 使用argparse库完成训练时参数的配置。
- 根据输入的参数，选择对应项模型和算法，配置相应数量的客户信息。
- 开始训练，并输出训练结果。
- 完成训练，保存模型。

### 模型类
其中主要保存了训练需要的模型，进行基础的模型设置。（神经网络的模型架构）

### 服务类
负责与客户端与服务端交互的中间类，包括模拟客户端训练模型，上传客户训练参数，服务端模型参数更新，模型的下发等过程。

### 客户类
训练本地模型，上传模型参数。

## 详细训练流程
- 下发模型
  - 先将模型下发给客户。
- 模拟客户训练
  - 随机挑选某些客户，模拟客户完成了模型更新。
- 模拟客户上传
  - 训练出新模型的客户将模型上传到服务端，根据权重更新模型。
- 重复此流程

## 一些问题
### 大量客户的并行问题
框架中展示了20个用户同时使用的情况，但是如果训练方法得到推广，如何处理更多用户的需求？可能涉及到并行算法的设计。
### 权重算法
观察到权重算法存在疑问，权重信息是由数据所占比例决定的，但是这个数据并非总数据，而是每轮新上传模型的客户的总数据，这可能会导致一些问题，因为假如有一个客户每轮都上传，其他客户上传次数少，但是数据量大，那么每轮上传总有几轮会导致他的梯度权重过大，模型向他的方向倾斜。

比如A用户每次都上传，上传1单位数据，B用户每隔3次上传一次，上传10单位数据。按照理想情况，模型权重收到双方数据的影响的比例应该维持在`3:10`

但是实际上模型权重收到的影响应该是`1:0`,`2:0`,`(3:0)/11+(2:10)*10/11=23:100`。

所以如果出现这样的更新频率不同，最终模型权重会向更偏向更新频率高的客户。